{
  "_id": "hubspot-company-update-share",
  "type": "pipe",
  "source": {
    "type": "dataset",
    "dataset": "hubspot-company-transform",
    "subset": ["eq",
      ["is-not-empty", "_S.id"], true]
  },
  "sink": {
    "type": "rest",
    "system": "hubspot",
    "operation": "update"
  },
  "transform": [{
    "type": "dtl",
    "rules": {
      "default": [
        ["discard",
          ["is-not-empty", "_S.id"]
        ],
        ["copy", "*"]
      ]
    }
  }, {
    "type": "rest",
    "system": "hubspot",
    "operation": "hash",
    "replace_entity": false
  }, {
    "type": "dtl",
    "rules": {
      "default": [
        ["discard",
          ["eq", "_S.response.updatedAt", "_S.$hash"]
        ],
        ["add", "::payload",
          ["dict", "properties", "_S.properties"]
        ],
        ["add", "::properties",
          ["dict", "id", "_S.id", "url", "companies"]
        ]
      ]
    }
  }],
  "batch_size": 1
}
