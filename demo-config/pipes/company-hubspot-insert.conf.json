{
  "_id": "company-hubspot-insert",
  "type": "pipe",
  "source": {
    "type": "dataset",
    "dataset": "company-hubspot",
    "subset": ["eq",
      ["is-empty", "_S.id"], true]
  },
  "transform": [{
    "type": "dtl",
    "rules": {
      "default": [
        ["discard",
          ["is-null", "_S.id"]
        ],
        ["discard",
          ["is-not-empty",
            ["hops", {
              "datasets": ["company-hubspot-insert chi"],
              "where": [
                ["eq", "_S.sesam-id", "chi.sesam-id"]
              ]
            }]
          ]
        ],
        ["add", "::payload",
          ["dict", "properties", "_S.properties"]
        ],
        ["copy", "sesam-id"]
      ]
    }
  }, {
    "type": "rest",
    "system": "hubspot",
    "operation": "insert",
    "properties": {
      "url": "companies"
    },
    "replace_entity": false
  }, {
    "type": "dtl",
    "rules": {
      "default": [
        ["copy", "sesam-id"],
        ["merge-union", "_S.response"],
        ["add", "_id", "_T.id"]
      ]
    }
  }],
  "pump": {
    "run_at_startup_if_not_populated": true
  },
  "add_namespaces": false,
  "disable_set_last_seen": true,
  "exclude_completeness": ["company-hubspot"],
  "reprocessing_policy": "continue"
}
